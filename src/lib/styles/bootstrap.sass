@use './font-face-info' as fonts
@use './typography' as typography
@use './utils' as utils
@use 'sass:color'
@use 'sass:map'

// Helper function to generate CSS variables from a map
@mixin generate-css-vars($map)
  @each $key, $value in $map
    --tint-#{$key}: #{$value}

// Function to generate tint color variables
@mixin generate-color-variables($colors)
  :root
    @include generate-css-vars(map.get($colors, general))
  :root, .tint--plain
    @include generate-css-vars(map.get($colors, plain))
  .tint--tinted
    @include generate-css-vars(map.get($colors, tint))

// generate-font-faces
@mixin generate-font-faces($path: '~tint/fonts')
  @each $font in fonts.$fonts
    @font-face
      font-family: map.get($font, family)
      font-weight: map.get($font, weight)
      font-style: map.get($font, style)
      src: url(#{$path}/#{map.get($font, filename)}.woff2) format(woff2)

// Define layers order. If you have more layers, you can use the variable
$layer-names: tint-reset, tint-typography, tint-global
@mixin layers()
  @layer $layer-names

// Define the tint typography classes
@mixin type-classes()
  @include typography.generate-tint-classes()

// Prose styles for standardized content
@mixin prose-styles()
  .tint--type, .tint--type-sans
    // Headings
    h1
      @include typography.type-class(title-serif-1)
      margin-block-start: utils.$size-32
      margin-block-end: utils.$size-16
      &:first-child
        margin-block-start: 0
    h2
      @include typography.type-class(title-serif-2)
      margin-block-start: utils.$size-32
      margin-block-end: utils.$size-16
      &:first-child
        margin-block-start: 0
    h3
      @include typography.type-class(title-serif-3)
      margin-block-start: utils.$size-24
      margin-block-end: utils.$size-12
      &:first-child
        margin-block-start: 0
    h4, h5, h6
      @include typography.type-class(title-sans-3)
      margin-block-start: utils.$size-24
      margin-block-end: utils.$size-12
      &:first-child
        margin-block-start: 0

    // Links
    a
      color: var(--tint-text-link)
      text-decoration: underline
      &:hover
        text-decoration: none

    // Lists
    li
      margin-block-end: utils.$size-8
      &:last-child
        margin-block-end: 0

    // Code
    code
      @include typography.type-class(body-sans-small)
      background: var(--tint-input-bg)
      color: var(--tint-text-accent)
      padding: utils.$size-2 utils.$size-4
      border-radius: utils.$size-4
      border: 1px solid var(--tint-card-border)
    pre
      @include typography.type-class(body-sans-small)
      background: var(--tint-input-bg)
      color: var(--tint-text)
      padding: utils.$size-16
      border-radius: utils.$size-8
      border: 1px solid var(--tint-card-border)
      overflow-x: auto
      margin-block-end: utils.$size-16
      line-height: 1.6
      &:last-child
        margin-block-end: 0
      code
        background: transparent
        color: inherit
        padding: 0
        border: none
        border-radius: 0

    // Emphasis
    strong
      font-weight: 700
    em
      font-style: italic

    // Keyboard
    kbd
      @include typography.type-class(ui-small)
      background: var(--tint-input-bg)
      color: var(--tint-text)
      padding: utils.$size-2 utils.$size-8
      border-radius: utils.$size-4
      border: 1px solid var(--tint-card-border)
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1)
      font-family: monospace

    // Definition lists
    dl
      margin-block-end: utils.$size-16
      &:last-child
        margin-block-end: 0

    // Horizontal rule
    hr
      border: none
      border-top: 1px solid var(--tint-card-border)
      margin-block-start: utils.$size-24
      margin-block-end: utils.$size-24

  // Serif variant (default)
  .tint--type
    // Paragraphs
    p
      @include typography.type-class(body-serif)
      margin-block-end: utils.$size-16
      line-height: 1.7
      &:last-child
        margin-block-end: 0

    // Lists
    ul, ol
      @include typography.type-class(body-serif)
      margin-block-end: utils.$size-16
      padding-inline-start: utils.$size-24
      line-height: 1.7
      &:last-child
        margin-block-end: 0

    // Blockquote
    blockquote
      @include typography.type-class(body-serif)
      color: var(--tint-text-secondary)
      border-left: utils.$size-4 solid var(--tint-card-border)
      padding-inline-start: utils.$size-16
      margin-inline-start: 0
      margin-block-end: utils.$size-16
      font-style: italic
      line-height: 1.7
      &:last-child
        margin-block-end: 0
      p
        margin-block-end: utils.$size-12
        &:last-child
          margin-block-end: 0

    dt
      @include typography.type-class(body-serif-bold)
      margin-block-start: utils.$size-12
      &:first-child
        margin-block-start: 0
    dd
      @include typography.type-class(body-serif)
      margin-inline-start: utils.$size-24
      margin-block-end: utils.$size-8
      line-height: 1.7

  // Sans variant
  .tint--type-sans
    // Paragraphs
    p
      @include typography.type-class(body-sans)
      margin-block-end: utils.$size-16
      line-height: 1.4
      &:last-child
        margin-block-end: 0

    // Lists
    ul, ol
      @include typography.type-class(body-sans)
      margin-block-end: utils.$size-16
      padding-inline-start: utils.$size-24
      line-height: 1.4
      &:last-child
        margin-block-end: 0

    // Blockquote
    blockquote
      @include typography.type-class(body-sans)
      color: var(--tint-text-secondary)
      border-left: utils.$size-4 solid var(--tint-card-border)
      padding-inline-start: utils.$size-16
      margin-inline-start: 0
      margin-block-end: utils.$size-16
      line-height: 1.4
      &:last-child
        margin-block-end: 0
      p
        margin-block-end: utils.$size-12
        &:last-child
          margin-block-end: 0

    dt
      @include typography.type-class(body-sans-bold)
      margin-block-start: utils.$size-12
      &:first-child
        margin-block-start: 0
    dd
      @include typography.type-class(body-sans)
      margin-inline-start: utils.$size-24
      margin-block-end: utils.$size-8
      line-height: 1.4

// Define the tint base styles
@mixin base()
  @layer tint-reset
    *, *::before, *::after
      margin: 0
      padding: 0
      font-size: inherit
      font-family: inherit
  @layer tint-global
    body
      margin: 0
      background: var(--tint-bg)
      color: var(--tint-text)
      font-family: "HK Grotesk"
      font-weight: 500
      font-size: 16px
    h1.tint--type
      @include typography.type-class(title-serif-1)
    h2.tint--type
      @include typography.type-class(title-serif-2)
    h3.tint--type
      @include typography.type-class(title-serif-3)
    .tint--tinted, .tint--plain
      color: var(--tint-text)
    a, button
      color: inherit
    .tint--card
      border-radius: utils.$card-radius
      border: 1px solid var(--tint-card-border)
      box-shadow: var(--tint-card-shadow)
      background: var(--tint-bg)
    .tint--link
      color: var(--tint-text-link)
      text-decoration: none
      &:hover
        text-decoration: underline
    .tint--visually-hidden
      width: 0.001px
      height: 0.001px
      opacity: 0.01
      overflow: hidden
      position: absolute
      z-index: -1
    .tint--reorderable-indicator
      height: 2px
      background-color: var(--tint-action-primary)
      pointer-events: none
      margin-block: -1px
      width: 4em
      position: absolute
      z-index: 1
      top: 0
      border-radius: 1px
    .tint--reorderable-container *[draggable="true"]
      &:hover
        cursor: grab
      &:active
        cursor: grabbing
    .tint-tooltip-wrapper
      position: absolute
      z-index: 9999
      opacity: 0
      transform: translateY(-4px)
      transition: opacity 0.1s, transform 0.1s
      pointer-events: none
      max-width: 250px
      overflow: visible
      border: none
      background: none
      &.tint-tooltip--top .tint-tooltip-arrow
        top: auto
        bottom: -5px
        border-top: 6px solid var(--tint-text)
        border-bottom: none
      &.tint-tooltip--bottom .tint-tooltip-arrow
        top: -5px
        bottom: auto
        border-top: none
        border-bottom: 6px solid var(--tint-text)
    .tint-tooltip-arrow
      position: absolute
      width: 0
      height: 0
      border-left: 6px solid transparent
      border-right: 6px solid transparent
      pointer-events: none
    .tint-tooltip-bubble
      background-color: var(--tint-text)
      color: var(--tint-bg)
      padding: utils.$size-4
      border-radius: utils.$size-8
      word-wrap: break-word
      box-shadow: 0 2px 6px rgba(0, 0, 0, .15)
      text-align: center
    .tint-tooltip-text
      margin: 0
      text-rendering: optimizeLegibility
      -webkit-font-smoothing: antialiased
      -moz-osx-font-smoothing: grayscale
    @include prose-styles()

@mixin full-bootstrap($path: '~tint/fonts')
  @include layers()
  @include base()
  @layer tint-typography
    @include type-classes()
  @include generate-font-faces($path)
